<div class="signup-container">
  <div class="signup-header">
    <i class="fas fa-user-plus"></i>
    <h2>Join Educare</h2>
    <p>Create your account to access the PlaySchool Management System</p>
  </div>

  <form [formGroup]="signupForm" (ngSubmit)="onSubmit()" class="signup-form">
    
    <!-- Personal Information Section -->
    <div class="form-section">
      <h3><mat-icon>person</mat-icon> Personal Information</h3>
      
      <div class="form-row">
        <mat-form-field appearance="outline" class="half-width">
          <mat-label>First Name</mat-label>
          <input matInput
                 type="text"
                 formControlName="firstName"
                 placeholder="Enter first name"
                 autocomplete="given-name">
          <mat-icon matSuffix>person</mat-icon>
          <mat-error *ngIf="isFieldInvalid('firstName')">
            {{ getFieldError('firstName') }}
          </mat-error>
        </mat-form-field>

        <mat-form-field appearance="outline" class="half-width">
          <mat-label>Last Name</mat-label>
          <input matInput
                 type="text"
                 formControlName="lastName"
                 placeholder="Enter last name"
                 autocomplete="family-name">
          <mat-icon matSuffix>person</mat-icon>
          <mat-error *ngIf="isFieldInvalid('lastName')">
            {{ getFieldError('lastName') }}
          </mat-error>
        </mat-form-field>
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Email Address</mat-label>
        <input matInput
               type="email"
               formControlName="email"
               placeholder="Enter email address"
               autocomplete="email">
        <mat-icon matSuffix>email</mat-icon>
        <mat-error *ngIf="isFieldInvalid('email')">
          {{ getFieldError('email') }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Phone Number (Optional)</mat-label>
        <input matInput
               type="tel"
               formControlName="phoneNumber"
               placeholder="Enter phone number"
               autocomplete="tel">
        <mat-icon matSuffix>phone</mat-icon>
        <mat-error *ngIf="isFieldInvalid('phoneNumber')">
          {{ getFieldError('phoneNumber') }}
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Account Information Section -->
    <div class="form-section">
      <h3><mat-icon>account_circle</mat-icon> Account Information</h3>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Username</mat-label>
        <input matInput
               type="text"
               formControlName="username"
               placeholder="Choose a username"
               autocomplete="username">
        <mat-icon matSuffix>account_circle</mat-icon>
        <mat-error *ngIf="isFieldInvalid('username')">
          {{ getFieldError('username') }}
        </mat-error>
      </mat-form-field>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Role</mat-label>
        <mat-select formControlName="role">
          <mat-option *ngFor="let role of roleOptions" [value]="role.value">
            <mat-icon>{{ role.icon }}</mat-icon>
            {{ role.label }}
          </mat-option>
        </mat-select>
        <mat-icon matSuffix>work</mat-icon>
      </mat-form-field>
    </div>

    <!-- Password Section -->
    <div class="form-section">
      <h3><mat-icon>lock</mat-icon> Security</h3>
      
      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Password</mat-label>
        <input matInput
               [type]="hidePassword ? 'password' : 'text'"
               formControlName="password"
               placeholder="Create a password"
               autocomplete="new-password">
        <button mat-icon-button matSuffix
                type="button"
                (click)="hidePassword = !hidePassword">
          <mat-icon>{{hidePassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        <mat-error *ngIf="isFieldInvalid('password')">
          {{ getFieldError('password') }}
        </mat-error>
      </mat-form-field>

      <!-- Password Strength Indicator -->
      <div class="password-strength" *ngIf="signupForm.get('password')?.value">
        <div class="strength-bar">
          <div class="strength-fill" 
               [style.width]="getPasswordStrength() === 'weak' ? '33%' : getPasswordStrength() === 'medium' ? '66%' : '100%'"
               [style.background-color]="getPasswordStrengthColor()">
          </div>
        </div>
        <span class="strength-text" [style.color]="getPasswordStrengthColor()">
          {{ getPasswordStrength() | titlecase }} Password
        </span>
      </div>

      <mat-form-field appearance="outline" class="full-width">
        <mat-label>Confirm Password</mat-label>
        <input matInput
               [type]="hideConfirmPassword ? 'password' : 'text'"
               formControlName="confirmPassword"
               placeholder="Confirm your password"
               autocomplete="new-password">
        <button mat-icon-button matSuffix
                type="button"
                (click)="hideConfirmPassword = !hideConfirmPassword">
          <mat-icon>{{hideConfirmPassword ? 'visibility_off' : 'visibility'}}</mat-icon>
        </button>
        <mat-error *ngIf="isFieldInvalid('confirmPassword')">
          {{ getFieldError('confirmPassword') }}
        </mat-error>
      </mat-form-field>
    </div>

    <!-- Success Message -->
    <div class="success-message" *ngIf="successMessage">
      <mat-icon>check_circle</mat-icon>
      <span>{{ successMessage }}</span>
    </div>

    <!-- Error Message -->
    <div class="error-message" *ngIf="errorMessage">
      <mat-icon>error</mat-icon>
      <span>{{ errorMessage }}</span>
    </div>

    <!-- Debug Information -->
    <div class="debug-section" *ngIf="!signupForm.valid" style="background: #f5f5f5; padding: 1rem; margin: 1rem 0; border-radius: 4px; font-size: 0.8rem;">
      <strong>Form Status:</strong> {{ formDebugInfo }}
      <br>
      <button type="button" (click)="checkFormValidity()" style="margin-top: 0.5rem; padding: 0.25rem 0.5rem; font-size: 0.8rem;">
        Debug Form
      </button>
    </div>

    <!-- Action Buttons -->
    <div class="form-actions">
      <button mat-raised-button
              color="primary"
              type="submit"
              [disabled]="!signupForm.valid || isLoading"
              class="signup-btn"
              [title]="signupForm.valid ? 'Create your account' : 'Please fill all required fields correctly'">
        <mat-spinner *ngIf="isLoading" diameter="20"></mat-spinner>
        <span *ngIf="!isLoading">
          <mat-icon>person_add</mat-icon>
          Create Account
        </span>
        <span *ngIf="isLoading">Creating Account...</span>
      </button>

      <button mat-button
              type="button"
              (click)="onCancel()"
              [disabled]="isLoading"
              class="cancel-btn">
        Cancel
      </button>
    </div>
  </form>

  <!-- Additional Information -->
  <div class="signup-footer">
    <p>Already have an account? 
      <button mat-button color="primary" (click)="onCancel()" [disabled]="isLoading">
        Sign In Here
      </button>
    </p>
  </div>
</div>
