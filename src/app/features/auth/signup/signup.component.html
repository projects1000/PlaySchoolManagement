<!-- Beautiful Bootstrap Modal Signup Dialog with working validations -->
<div class="container-fluid">
  <div class="row justify-content-center">
    <div class="col-12">
      <div class="card shadow-lg border-0 rounded-4 overflow-hidden">

        <!-- Header -->
        <div class="card-header bg-gradient text-white text-center position-relative p-3">
          <button type="button" class="btn-close btn-close-white position-absolute top-0 end-0 m-3" (click)="onCancel()" aria-label="Close"></button>
          <div class="d-flex flex-column align-items-center">
            <i class="fas fa-graduation-cap fa-2x text-white mb-2"></i>
            <h3 class="fw-bold mb-1">Join Educare</h3>
            <p class="mb-0 opacity-75 small">Create your account</p>
          </div>
        </div>

        <!-- Body -->
        <div class="card-body p-3" #scrollContainer>
          <form [formGroup]="signupForm" (ngSubmit)="onSubmit()" class="needs-validation" novalidate>

            <!-- Error Alert -->
            <div *ngIf="errorMessage" class="alert alert-danger d-flex align-items-center" role="alert">
              <i class="fas fa-exclamation-triangle me-2"></i>
              <div>{{ errorMessage }}</div>
            </div>

            <!-- First Name -->
            <div class="mb-2">
              <label for="firstName" class="form-label fw-semibold">First Name</label>
              <input id="firstName" 
                     class="form-control" 
                     formControlName="firstName" 
                     placeholder="Enter first name"
                     (keydown)="onFieldEnterKey($event)">
              <small *ngIf="isFieldInvalid('firstName')" class="text-danger">{{ getFieldError('firstName') }}</small>
            </div>

            <!-- Last Name -->
            <div class="mb-2">
              <label for="lastName" class="form-label fw-semibold">Last Name</label>
              <input id="lastName" 
                     class="form-control" 
                     formControlName="lastName" 
                     placeholder="Enter last name"
                     (keydown)="onFieldEnterKey($event)">
              <small *ngIf="isFieldInvalid('lastName')" class="text-danger">{{ getFieldError('lastName') }}</small>
            </div>

            <!-- Email -->
            <div class="mb-2">
              <label for="email" class="form-label fw-semibold">Email</label>
              <input id="email" 
                     class="form-control" 
                     [class.is-invalid]="isFieldInvalid('email')"
                     [class.is-valid]="!isFieldInvalid('email') && signupForm.get('email')?.touched && signupForm.get('email')?.value"
                     formControlName="email" 
                     placeholder="Enter email"
                     (keydown)="onFieldEnterKey($event)">
              <small *ngIf="isFieldInvalid('email')" class="text-danger">
                <i class="fas fa-exclamation-triangle me-1"></i>{{ getFieldError('email') }}
              </small>
            </div>

            <!-- Username -->
            <div class="mb-2">
              <label for="username" class="form-label fw-semibold">Username</label>
              <input id="username" 
                     class="form-control" 
                     [class.is-invalid]="isFieldInvalid('username')"
                     [class.is-valid]="!isFieldInvalid('username') && signupForm.get('username')?.touched && signupForm.get('username')?.value"
                     formControlName="username" 
                     placeholder="Choose username"
                     (keydown)="onFieldEnterKey($event)">
              <small *ngIf="isFieldInvalid('username')" class="text-danger">
                <i class="fas fa-exclamation-triangle me-1"></i>{{ getFieldError('username') }}
              </small>
            </div>

            <!-- Phone Number -->
            <div class="mb-2">
              <label for="phoneNumber" class="form-label fw-semibold">Phone Number (optional)</label>
              <input id="phoneNumber" 
                     class="form-control" 
                     formControlName="phoneNumber" 
                     placeholder="Enter phone number"
                     (keydown)="onFieldEnterKey($event)">
              <small *ngIf="isFieldInvalid('phoneNumber')" class="text-danger">{{ getFieldError('phoneNumber') }}</small>
            </div>

            <!-- Password -->
            <div class="mb-2">
              <label for="password" class="form-label fw-semibold">Password</label>
              <div class="input-group">
                <input [type]="hidePassword ? 'password' : 'text'" 
                       id="password" 
                       class="form-control" 
                       formControlName="password" 
                       placeholder="Create a password"
                       (keydown)="onFieldEnterKey($event)">
                <button class="btn btn-outline-secondary" type="button" (click)="hidePassword = !hidePassword">
                  <i class="fas" [class.fa-eye]="hidePassword" [class.fa-eye-slash]="!hidePassword"></i>
                </button>
              </div>
              <small *ngIf="isFieldInvalid('password')" class="text-danger">{{ getFieldError('password') }}</small>
            </div>

            <!-- Confirm Password -->
            <div class="mb-2">
              <label for="confirmPassword" class="form-label fw-semibold">Confirm Password</label>
              <div class="input-group">
                <input [type]="hideConfirmPassword ? 'password' : 'text'" 
                       id="confirmPassword" 
                       class="form-control" 
                       formControlName="confirmPassword" 
                       placeholder="Confirm password"
                       (keydown)="onLastFieldEnterKey($event)">
                <button class="btn btn-outline-secondary" type="button" (click)="hideConfirmPassword = !hideConfirmPassword">
                  <i class="fas" [class.fa-eye]="hideConfirmPassword" [class.fa-eye-slash]="!hideConfirmPassword"></i>
                </button>
              </div>
              <small *ngIf="isFieldInvalid('confirmPassword')" class="text-danger">{{ getFieldError('confirmPassword') }}</small>
            </div>

            <!-- Role -->
            <div class="mb-2">
              <label for="role" class="form-label fw-semibold">Role</label>
              <select class="form-select" 
                      id="role" 
                      formControlName="role"
                      (keydown)="onFieldEnterKey($event)">
                <option *ngFor="let option of roleOptions" [value]="option.value">{{ option.label }}</option>
              </select>
              <small *ngIf="isFieldInvalid('role')" class="text-danger">{{ getFieldError('role') }}</small>
            </div>

            <!-- Terms -->
            <div class="form-check mb-3">
              <input class="form-check-input" 
                     type="checkbox" 
                     id="agreeTerms" 
                     formControlName="agreeTerms"
                     (keydown)="onLastFieldEnterKey($event)">
              <label class="form-check-label" for="agreeTerms">
                I agree to the Terms and Conditions
              </label>
              <br />
              <small *ngIf="isFieldInvalid('agreeTerms')" class="text-danger">{{ getFieldError('agreeTerms') }}</small>
            </div>

            <!-- Submit -->
            <button #submitButton class="btn btn-primary w-100" type="submit" [disabled]="signupForm.invalid || isLoading">
              <span *ngIf="isLoading" class="spinner-border spinner-border-sm me-2"></span>
              <i *ngIf="!isLoading" class="fas fa-user-plus me-2"></i>
              {{ isLoading ? 'Creating Account...' : 'Create Account' }}
            </button>

          </form>

          <!-- Success Message at Bottom -->
          <div *ngIf="successMessage" 
               id="successMessage"
               class="alert alert-success d-flex align-items-center mt-3" 
               role="alert">
            <i class="fas fa-check-circle me-2"></i>
            <div>{{ successMessage }}</div>
          </div>
        </div>

        <!-- Footer -->
        <div class="card-footer bg-light text-center border-0 py-2">
          <small class="text-muted">Already have an account? 
            <button type="button" 
                    class="btn btn-link p-0 text-decoration-none" 
                    style="vertical-align: baseline; font-size: inherit;"
                    (click)="switchToLogin()">
              Login
            </button>
          </small>
        </div>

      </div>
    </div>
  </div>
</div>
